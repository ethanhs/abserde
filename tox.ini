[tox]
envlist = lint,py36,py37
isolated_build = True

[testenv]
setenv =
    VIRTUALENV_NO_DOWNLOAD=1
deps =
    pytest >= 4.0
    pytest-benchmark
    mypy
    pre-commit
    orjson
    ujson

commands = python -m pytest {posargs}


[testenv:py36]
deps = pytest
commands = python -m pytest {posargs}
commands_pre =
    python -m pip install .
    python -m abserde examples/multiclass.pyi
    python -m pip install dist/*.whl

[testenv:py37]
# Python 3.6+ has a number of compile-time warnings on invalid string escapes.
# PYTHONWARNINGS=d and --no-compile below make them visible during the Tox run.
install_command = pip install --no-compile {opts} {packages}
setenv =
    PYTHONWARNINGS=d
deps = pytest
commands = python -m pytest {posargs}
commands_pre =
    python -m pip install .
    python -m abserde examples/multiclass.pyi
    python -m pip install dist/*.whl

[testenv:lint]
basepython = python3.7
skip_install = true
deps =
    pre-commit
    mypy
passenv = HOMEPATH  # needed on Windows
commands = pre-commit run --all-files


[flake8]
max-line-length = 99
